

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CSVSEL &mdash; GOR Open Source v.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/gorpipe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <nav class="wy-master-nav">
    <div class="gor-logo-home">
        <a href="../index.html">
            <img src="../_static/GORLogoText.svg" class="logo" />
        </a>
    </div>
    <div role="search" class="wxnc-search-form">
        <button class="wxnc-search-button" form="wxnc-search-form" formmethod="get">
            <i class="fa fa-search" aria-hidden="true"> </i>
        </button>
        <form id="wxnc-search-form" class="wy-form" action="../search.html" method="get">
            <input class="wxnc-no-right-border" size="30" type="text" name="q" placeholder="Search the user manual..."/>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
    </div>
</nav>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            
            
              <div class="version">
                <a href="../index.html">
                  GOR Open Source
                  <p class="wxnc-subtitle">Documentation</p>
                </a>
              </div>
            
          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GOR Open Source</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>CSVSEL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span style="float:right; padding-top:10px; color:#BABABA;">Used in: gor only</span><section id="csvsel-1">
<span id="csvsel"></span><h1>CSVSEL<a class="headerlink" href="#csvsel-1" title="Permalink to this headline">¶</a></h1>
<p>The <strong>CSVSEL</strong> command is used to select a subset of data stored in a horizontal manner, as compared to data on a row level.
Many analysis commands, such as regression and case-contol can leverage this representation for efficient evaluation.</p>
<p>The left-input stream must contain the columns <code class="docutils literal notranslate"><span class="pre">values</span></code> and <code class="docutils literal notranslate"><span class="pre">bucket</span></code>.  The tag-bucket relation is used to define
how the values for different tags are stored in the value column in each bucket.  The tag selection specifies which
tags are selected.  The output is a new value row with the tag values in a single column and a single row (buckets are collapsed).
If the <code class="docutils literal notranslate"><span class="pre">-tag</span></code> option is used, the tag values are output in separate rows.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-u</span></code> option provides the flexibility of having sparse buckets on row-level, i.e. “missing” rows.  As an example, when
variants are stored in this format, old buckets that were generated in the past might have less total number of variants
than those newly generated.  This option allows the output value for instance to be either homozygous reference or a value
denoting missing data.</p>
<p>Data stored horizontally in tables (dictionaries) uses multi-tags for each bucket file.  Thus, when the data is read,
the selection on the dictionary typically uses no filtering on the rows, i.e. <code class="docutils literal notranslate"><span class="pre">-nf</span></code>, since it is assumed that a subset of the tags
should return the entire row.  Thus, the filtering options <code class="docutils literal notranslate"><span class="pre">-f</span></code> and <code class="docutils literal notranslate"><span class="pre">-ff</span></code> in the <a class="reference internal" href="GOR.html#gor"><span class="std std-ref">GOR</span></a> command are not used to filter
the data, but rather the <a class="reference internal" href="#csvsel"><span class="std std-ref">CSVSEL</span></a> command.</p>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> ... | <span class="nb">CSVSEL</span> tagbucketrelation tagselection [-<span class="no">gc</span> cols] [-u undefsymbol] [-tag tagcolname] [-s sep] [-vs charsize]
</pre></div>
</div>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-gc</span> <span class="pre">cols</span></code></p></td>
<td><p>Grouping columns other than (chrom,pos)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">sep</span></code></p></td>
<td><p>Specify separator for the elements in values.  Default to comma.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-vs</span> <span class="pre">size</span></code></p></td>
<td><p>Use a fixed character size for values, e.g. rather than variable length separated with comma.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">undefsymbol</span></code></p></td>
<td><p>The symbol to use in case a bucket does not have the corresponding position and grouping columns.
Default value is 4.  Typical values can be 3, 4 or NA.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-tag</span> <span class="pre">colname</span></code></p></td>
<td><p>This option causes the horizontal values representing the individual tags to be unpivoted into
multiple rows and the column named as specified.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-hide</span> <span class="pre">blacklist</span></code></p></td>
<td><p>This option is only to be used together with the -tag option. The option hides those rows whose
corresponding value from the horizontal data, is on the blacklist. The blacklist should be a comma
separated list of strings.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-vcf</span></code></p></td>
<td><p>Takes the cropped out strings, X, which are assumed to be of length 1, computes DECODE(CHARS2GT(x))
of them and writes the results in separate columns.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-threshold</span> <span class="pre">thres</span></code></p></td>
<td><p>Only to be used together with the -vcf option. Takes the cropped out strings, X, which are assumed
to be of length 2, computes DECODE(CHARS2GT(x,thres),‘0’,‘0/0’,‘1’,‘0/1’,2,‘1/1’,‘./.’) of them.
Writes the results in separate columns.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-dose</span></code></p></td>
<td><p>Only to be used together with the -vcf option. Instead of using ‘chars2prprpr’ the function
‘chars2dose’ is used.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>/* An example of creating horizontal variations stored in buckets */

<span class="nd">create</span> #PNbuckets# = <span class="nd">nor</span> -asdict #wesVars# | <span class="nb">SELECT</span> #2 | <span class="nb">RENAME</span> #1 <span class="na">PN</span> | <span class="nb">ROWNUM</span>
| <span class="nb">CALC</span> bucket &#39;bucket&#39;+<span class="k">str</span>(div((rownum-1),500)+1) | <span class="nb">SELECT</span> <span class="na">PN</span>,bucket | <span class="nb">SORT</span> -c <span class="na">PN</span>;

<span class="nd">create</span> #allvars# = <span class="nd">gor</span> #wesvars# -ff [#PNbuckets#] | <span class="nb">SELECT</span> 1-4 | DISTINCT;

<span class="nd">create</span> #horvars# = <span class="nd">gor</span> [#allvars#]
| <span class="nb">CALC</span> GT <span class="k">IF</span>( Depth = 9999 OR GL_Call &gt;= 5 <span class="ni">AND</span> Depth &gt;= 8 <span class="ni">AND</span>
  (CallCopies = 2 <span class="ni">AND</span> CallRatio &gt;= 0.66 OR CallCopies = 1 <span class="ni">AND</span> CallRatio &gt;= 0.2
  <span class="ni">AND</span> CallRatio &lt;= 1.0-0.2), CallCopies, 3)
| gtgen -<span class="no">gc</span> #3,#4 [#PNbuckets#] &lt;(<span class="nd">gor</span> source/cov/goodcov_8.wgs.gord -s <span class="na">PN</span> -ff [#PNbuckets#]);

/* Selecting a random subset of PNs*/
<span class="nd">gor</span> [#horvars#] | <span class="nb">CSVSEL</span> [#PNbuckets#] &lt;(<span class="nd">nor</span> [#PNbuckets#] | <span class="nb">SELECT</span> #<span class="na">PN</span>
| <span class="nb">WHERE</span> random() &lt; 0.05) -<span class="no">gc</span> #3,#4 -u 4
</pre></div>
</div>
<p>The above query example generates a tag-bucket relation and a GOR relation with all variants.  Then horizontal variants are then created by expanding each variants with PN and bucket and followed with a left-join into the sparse variant table <code class="docutils literal notranslate"><span class="pre">#wesVars#</span></code> and the coverage table. The variant stream is then sorted into a PN order, consistent with the tag-bucket relation, and then collapsed into a comma-separated list per variant. The final query reads a random subset of PNs from the <code class="docutils literal notranslate"><span class="pre">#horvars#</span></code> relation.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>/* Selecting 10 PNs from the first bucket and return as rows */

<span class="nd">gor</span> [#horvars#] | <span class="nb">CSVSEL</span> -tag <span class="na">PN</span> [#PNbuckets#]
  &lt;(<span class="nd">nor</span> [#PNbuckets#] | <span class="nb">WHERE</span> bucket = &#39;bucket1&#39; | <span class="nb">SELECT</span> #<span class="na">PN</span> | top 10) -<span class="no">gc</span> #3,#4 -u 4

/* Selecting 10 PNs from the first bucket, a slightly faster version */

<span class="nd">gor</span> [#horvars#] | <span class="nb">WHERE</span> bucket = &#39;bucket1&#39; | <span class="nb">CSVSEL</span> -tag <span class="na">PN</span> [#PNbuckets#]
  &lt;(<span class="nd">nor</span> [#PNbuckets#] | <span class="nb">WHERE</span> bucket = &#39;bucket1&#39; | <span class="nb">SELECT</span> #<span class="na">PN</span> | top 10) -<span class="no">gc</span> #3,#4 -u 4
</pre></div>
</div>
<p>The last example show how data is read from a table with horizontal buckets and filtered, partially in the reading of the bucket partitions and also in the <a class="reference internal" href="#csvsel"><span class="std std-ref">CSVSEL</span></a> step.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> source/hvar/transwgs.gord -nf -ff myPNs.tsv | <span class="nb">CSVSEL</span> source/hvar/PNbuckets.tsv myPNs.tsv -<span class="no">gc</span> #3,#4 -u 4
</pre></div>
</div>
<section id="related-commands">
<h3>Related commands<a class="headerlink" href="#related-commands" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="CSVCC.html#csvcc"><span class="std std-ref">CSVCC</span></a> <a class="reference internal" href="GTGEN.html#gtgen"><span class="std std-ref">GTGEN</span></a> <a class="reference internal" href="GTLD.html#gtld"><span class="std std-ref">GTLD</span></a></p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 GOR Open Source Project

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>