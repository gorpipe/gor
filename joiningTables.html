

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Joining Tables &mdash; GOR Open Source v.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/gorpipe.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Map and Multimap" href="mapMultimap.html" />
    <link rel="prev" title="Nested Streams" href="nestedStreams.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <nav class="wy-master-nav">
    <div class="gor-logo-home">
        <a href="index.html">
            <img src="_static/GORLogoText.svg" class="logo" />
        </a>
    </div>
    <div role="search" class="wxnc-search-form">
        <button class="wxnc-search-button" form="wxnc-search-form" formmethod="get">
            <i class="fa fa-search" aria-hidden="true"> </i>
        </button>
        <form id="wxnc-search-form" class="wy-form" action="search.html" method="get">
            <input class="wxnc-no-right-border" size="30" type="text" name="q" placeholder="Search the user manual..."/>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
    </div>
</nav>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            
            
              <div class="version">
                <a href="index.html">
                  GOR Open Source
                  <p class="wxnc-subtitle">Documentation</p>
                </a>
              </div>
            
          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="introduction.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicGORqueries.html">GOR and NOR</a></li>
<li class="toctree-l2"><a class="reference internal" href="filteringStreams.html">Filtering Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="columnModifications.html">Column Modifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupingAndAggregation.html">Grouping and Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="nestedStreams.html">Nested Streams</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Joining Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#join-conditions">Join conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#join-options">Join options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#left-joins">Left joins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-positions">Stop positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fuzzy-joins">Fuzzy joins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verifying-genomic-order">Verifying genomic order</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#joins-in-nor">Joins in NOR</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mapMultimap.html">Map and Multimap</a></li>
<li class="toctree-l2"><a class="reference internal" href="pivoting.html">Pivoting</a></li>
<li class="toctree-l2"><a class="reference internal" href="sequenceReads.html">Sequence Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="variantData.html">Variation Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="materializedViews.html">Materialized Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallelGOR.html">Parallelization in GOR</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-is-gor">What is GOR?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#writing-gor-queries">Writing GOR queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#reference-data">Reference Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GOR Open Source</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="introduction.html">Tutorials</a> &raquo;</li>
        
      <li>Joining Tables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="joining-tables">
<span id="joiningtables"></span><h1>Joining Tables<a class="headerlink" href="#joining-tables" title="Permalink to this headline">¶</a></h1>
<p>Joins are a key operation when working in relational databases and this is also the case in the GOR system. For whole genome query analysis, it is often necessary to be able to perform genomically spatial joins on a large number of features quickly. It is implicit when performing joins in the GOR system to do spatial proximity joins according to the genomic position of the data.</p>
<p>There are many different types of joins that can be performed using the GOR language. A full reference for the JOIN command can be found <a class="reference internal" href="command/JOIN.html#join"><span class="std std-ref">here</span></a>, but this chapter will go into several of the most useful operations that can be performed with GOR joins.</p>
<section id="join-conditions">
<h2>Join conditions<a class="headerlink" href="#join-conditions" title="Permalink to this headline">¶</a></h2>
<p>We must first consider whether we are joining based on single positions (for example, if we are working with a file that has only the chromosome and the position defined, as is the case with the <code class="docutils literal notranslate"><span class="pre">#dbsnp#</span></code> table) or based on segments, where the start and stop position are defined in each row (as is the case in a table such as <code class="docutils literal notranslate"><span class="pre">#genes#</span></code>).</p>
<p>The table below shows a list of the different types of joins that can be performed along with a description of each.</p>
<table class="docutils align-default" id="table-1">
<caption><span class="caption-text">Types of joins</span><a class="headerlink" href="#table-1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-snpsnp</span></code></p></td>
<td><p>Matches single positions in one table to single positions in another table.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-snpseg</span></code></p></td>
<td><p>Matches single positions in one table to segments in another table.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-segseg</span></code></p></td>
<td><p>Matches segments in two tables that overlap.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-varseg</span></code></p></td>
<td><p>Matches the overlap between one table (based on ref,alt) with a segment.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-segvar</span></code></p></td>
<td><p>Matches a segment to a variant (ref,alt) in the right source.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="join-options">
<h2>Join options<a class="headerlink" href="#join-options" title="Permalink to this headline">¶</a></h2>
<p>The first type of join (<code class="docutils literal notranslate"><span class="pre">-snpsnp</span></code>) matches single positions in one table to single position in another table. In this most basic example, we could join <code class="docutils literal notranslate"><span class="pre">wesVars</span></code> to a <a class="reference internal" href="glossary.html#term-vep"><span class="xref std std-term">VEP</span></a> dictionary (in this case the vep_single_wgs.gord) to annotate the variants in a particular set of samples with <a class="reference internal" href="glossary.html#term-vep"><span class="xref std std-term">VEP</span></a> data.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>     <span class="nd">gor</span> source/var/wes_varcalls.gor
| <span class="nb">TOP</span> 10
| <span class="nb">JOIN</span> -<span class="no">snpsnp</span> -xl <span class="na">reference</span>,<span class="na">call</span> -xr <span class="na">reference</span>,<span class="na">call</span> source/anno/vep_v85/vep_single_wgs_gord
</pre></div>
</div>
<p>Here we have introduced two extra options for having an exact match also on the reference and call columns in the left source (<code class="docutils literal notranslate"><span class="pre">-xl</span></code>) and in the right source (<code class="docutils literal notranslate"><span class="pre">-xr</span></code>). This is also referred to in this manual as an <a class="reference internal" href="glossary.html#term-equi-join"><span class="xref std std-term">equi-join</span></a>.</p>
<p id="negativejoins">In the next example, we are using a negative join to return the variants in our samples minus the variants in dbSNP, which would tell us if there are any novel variants in our sample data:</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #wesvars#
| <span class="nb">JOIN</span> -n #dbsnp# -<span class="no">snpsnp</span> -xl <span class="na">reference</span>,<span class="na">call</span> -xr <span class="na">reference</span>,<span class="na">allele</span>
</pre></div>
</div>
<p>Note that, in this case, the <em>reference</em> column from the left must match the <em>reference</em> column on the right, but the <em>call</em> must match to <em>allele</em>.</p>
<p id="intersectjoins">We can perform a basic intersect join by using the <code class="docutils literal notranslate"><span class="pre">-i</span></code> option. An intersect join will return only the overlap between two tables. In the following example, we are finding variants overlapping with a gene list (defined here as <code class="docutils literal notranslate"><span class="pre">[my_gene_coordinates]</span></code>). Since the gene list will be defined in terms of segments, we must use a <code class="docutils literal notranslate"><span class="pre">-snpseg</span></code> join condition here.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #wesVars#
| <span class="nb">JOIN</span> -<span class="no">snpseg</span> -i [my_gene_coordinates]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Segment ranges in GOR are zero-based UCSC style, e.g. (start,stop)=(100,200) denotes a genomic segment including bases 101-200, i.e. of length 100bp.</p>
</aside>
</section>
<section id="left-joins">
<span id="leftjoins"></span><h2>Left joins<a class="headerlink" href="#left-joins" title="Permalink to this headline">¶</a></h2>
<p>When we talk about <em>left joins</em> in GOR, we are talking about joins that are known in the SQL world as <em>left outer joins</em>. In the following example, we are joining our sample variants to the frequency table, but we do not want to drop the row that fail to match. In this case, if we encounter rows that do not match, we use the <code class="docutils literal notranslate"><span class="pre">-e</span></code> option to fill empty results with “0.0”.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #wesvars#
| join -l -<span class="no">snpsnp</span> -e 0.0 #freqmax#
</pre></div>
</div>
</section>
<section id="stop-positions">
<h2>Stop positions<a class="headerlink" href="#stop-positions" title="Permalink to this headline">¶</a></h2>
<p>When you are joining using any of the options that use segments (<code class="docutils literal notranslate"><span class="pre">-snpseg</span></code>, <code class="docutils literal notranslate"><span class="pre">-segseg</span></code>, or <code class="docutils literal notranslate"><span class="pre">-segsnp</span></code>), the stop position for the segments is assumed to be the third column (column #3) in the table. However, this may not be the case for some reason, such as when you are joining to a nested stream and the order of the columns has been changed.</p>
<p>In these cases, it can be useful to use the options <code class="docutils literal notranslate"><span class="pre">-lstop</span></code> and <code class="docutils literal notranslate"><span class="pre">-rstop</span></code> which both take a single parameter of the column that should be used as the stop position for the segment (in the left and right sources respectively).</p>
</section>
<section id="fuzzy-joins">
<span id="fuzzyjoins"></span><h2>Fuzzy joins<a class="headerlink" href="#fuzzy-joins" title="Permalink to this headline">¶</a></h2>
<p>Fuzzy joins are created in GOR queries by using the <code class="docutils literal notranslate"><span class="pre">-f</span></code> option on the query followed by the degree (an integer value) of the fuzziness.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #dbsnp# | <span class="nb">TOP</span> 1000 | <span class="nb">JOIN</span> -<span class="no">snpseg</span> #exons# -<span class="no">f</span> 10 | <span class="nb">SELECT</span> 1-10
</pre></div>
</div>
<table class="docutils align-default" id="table-2">
<caption><span class="caption-text">Joining #dbsnp# and #exons#</span><a class="headerlink" href="#table-2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 11.8%" />
<col style="width: 5.9%" />
<col style="width: 5.9%" />
<col style="width: 17.6%" />
<col style="width: 5.9%" />
<col style="width: 11.8%" />
<col style="width: 11.8%" />
<col style="width: 5.9%" />
<col style="width: 17.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Chrom</p></th>
<th class="head"><p>POS</p></th>
<th class="head"><p>reference</p></th>
<th class="head"><p>allele</p></th>
<th class="head"><p>rsIDs</p></th>
<th class="head"><p>distance</p></th>
<th class="head"><p>chromstart</p></th>
<th class="head"><p>chromend</p></th>
<th class="head"><p>gene_symbol</p></th>
<th class="head"><p>exon</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>chr16</p></td>
<td><p>89978525</p></td>
<td><p>C</p></td>
<td><p>T</p></td>
<td><p>rs908913173</p></td>
<td><p>2</p></td>
<td><p>89978526</p></td>
<td><p>89979053</p></td>
<td><p>MC1R</p></td>
<td><p>ENSE00002231523</p></td>
</tr>
<tr class="row-odd"><td><p>chr16</p></td>
<td><p>89978529</p></td>
<td><p>A</p></td>
<td><p>T</p></td>
<td><p>rs187669455</p></td>
<td><p>0</p></td>
<td><p>89978526</p></td>
<td><p>89979053</p></td>
<td><p>MC1R</p></td>
<td><p>ENSE00002231523</p></td>
</tr>
</tbody>
</table>
<p>In the example shown above, we have set the join to be fuzzy with a degree of 10, which allows us to widen our result set.</p>
<p>Notice that all of the rows from the original <code class="docutils literal notranslate"><span class="pre">#dbsnp#</span></code> table are included this time, but in the case of the first row, the distance is now equal to 2, which is how far outside of the exact match that row is.</p>
</section>
<section id="verifying-genomic-order">
<h2>Verifying genomic order<a class="headerlink" href="#verifying-genomic-order" title="Permalink to this headline">¶</a></h2>
<p>If we are joining multiple tables and rearranging the columns in our result set, it can sometimes occur that the genomic order is violated in the GOR output. In these cases, the <a class="reference internal" href="command/VERIFYORDER.html#verifyorder"><span class="std std-ref">VERIFYORDER</span></a> command can be used to check the genomic order of the GOR output. If the command is added to the end of a GOR query, it will throw an exception if the genomic order of the GOR stream is violated.</p>
<p>If there is a problem with the genomic order of a GOR stream, it can be useful to use the <a class="reference internal" href="command/SORT.html#sort"><span class="std std-ref">SORT</span></a> command to correct the violated order.</p>
<section id="joins-in-nor">
<span id="joins-nor"></span><h3>Joins in NOR<a class="headerlink" href="#joins-in-nor" title="Permalink to this headline">¶</a></h3>
<p>As we discussed at the beginning of this manual, when we are working with files in a <a class="reference internal" href="command/NOR.html#nor"><span class="std std-ref">NOR</span></a> context, we cannot rely on genomic-ordered data to join tables. Joins in NOR queries are performed using the <a class="reference internal" href="command/MAP.html#map"><span class="std std-ref">MAP</span></a> and <a class="reference internal" href="command/MULTIMAP.html#multimap"><span class="std std-ref">MULTIMAP</span></a> commands, which are discussed in the following chapter on <a class="reference internal" href="mapMultimap.html#mapmultimap"><span class="std std-ref">Map and Multimap</span></a>.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mapMultimap.html" class="btn btn-neutral float-right" title="Map and Multimap" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="nestedStreams.html" class="btn btn-neutral float-left" title="Nested Streams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 GOR Open Source Project

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>